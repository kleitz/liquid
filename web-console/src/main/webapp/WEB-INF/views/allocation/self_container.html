<!DOCTYPE html>
<html>
<head>
    <div th:include="layout :: head"></div>
</head>

<body>
<!-- {!begin layout} -->
<div th:include="layout :: header"></div>
<!-- {!end layout} -->

<!-- {!begin task bar} -->
<div th:include="layout :: task-bar"/>
<!-- {!end task bar} -->

<div class="row">

</div>

<div class="container" th:if="${task.assignee}">
    <div class="col-lg-6">
        <div class="panel panel-default">
            <div class="panel-heading">
                <span th:text="#{container.list}">Container List</span>
                
                <div class="pull-right">                
                    <div class="btn-group">
                        <button type="button" class="btn btn-default dropdown-toggle btn-xs" data-toggle="dropdown">
                            <span th:text="#{route} + ${routeId}">Route ID</span><span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu">
                            <li th:each="route : ${containerAllocation.routes}">
                                <a th:href="'/task/' + ${taskId} + '/allocation?number=' + ${page.number} + '&amp;routeId=' + ${route.id} + '&amp;ownerId=' + ${ownerId} + '&amp;yardId=' + ${yardId}" th:text="#{route} + ${route.id}">Route ID</a>
                            </li>
                        </ul>
                    </div><!-- route -->
                    
                    <div class="btn-group">
                        <button type="button" class="btn btn-default dropdown-toggle btn-xs" data-toggle="dropdown">  
                            <span th:if="${ownerId==0}" th:text="#{container.all.owners}">All Owner</span>
                            <span th:unless="${ownerId==0}" th:text="${owners.?[id == __${ownerId}__][0].name}">Owner</span>
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu">
                            <li>
                                <a href="#" th:href="'/task/' + ${taskId} + '/allocation?number=' + ${page.number} + '&amp;routeId=' + ${routeId} + '&amp;ownerId=0' + '&amp;yardId=' + ${yardId}"
                                    th:text="#{container.all.owners}">All Owners</a>
                            </li>
                            <li th:each="owner : ${owners}">
                                <a href="#" th:href="'/task/' + ${taskId} + '/allocation?number=' + ${page.number} + '&amp;routeId=' + ${routeId} + '&amp;ownerId=' + ${owner.id} + '&amp;yardId=' + ${yardId}"
                                    th:text="${owner.name}">Owner</a>
                            </li>
                        </ul>
                    </div><!-- owner -->
                    
                    <div class="btn-group">
                        <button type="button" class="btn btn-default dropdown-toggle btn-xs" data-toggle="dropdown">
                            <span th:if="${yardId==0}" th:text="#{container.all.yards}">All Yards</span>
                            <span th:unless="${yardId==0}" th:text="${yards.?[id == __${yardId}__][0].name}">Yard</span>
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" role="menu">
                            <li>
                                <a href="#" th:href="'/task/' + ${taskId} + '/allocation?number=' + ${page.number} + '&amp;routeId=' + ${routeId} + '&amp;ownerId=' + ${ownerId} + '&amp;yardId=0'"
                                    th:text="#{container.all.yards}">All Yard</a>
                            </li>
                            <li th:each="yard : ${yards}">
                                <a href="#" th:href="'/task/' + ${taskId} + '/allocation?number=' + ${page.number} + '&amp;routeId=' + ${routeId} + '&amp;ownerId=' + ${ownerId} + '&amp;yardId=' + ${yard.id}"
                                    th:text="${yard.name}">Yard</a>
                            </li>
                        </ul>
                    </div><!-- yard -->       
                </div>         
            </div><!-- panel-heading -->
            
            <div class="panel-body">
                <form method="post" th:action="'/task/' + ${taskId} + '/allocation'" th:object="${selfContainerAllocation}">
                    <input type="hidden" th:field="*{routeId}"/>
                    <table class="table table-striped table-hover table-condensed table-16">
                        <thead>
                            <tr>
                                <th></th>
                                <th>BIC Code</th>
                                <th th:text="#{container.owner}">Owner</th>
                                <th th:text="#{container.yard}">Yard</th>
                                <th th:text="#{container.subtype}">Subtype</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="container, rowStat: ${page.content}">
                                <td><input type="checkbox" th:value="${container.id}" th:field="*{containerIds}"/></td>
                                <td><b><span th:text="${container.bicCode}">BIC Code</span></b></td>
                                <td><span th:text="${container.owner.name}">Owner Name</span></td>
                                <td><span th:text="${container.yard.name}">Yard Name</span></td>
                                <td><span th:text="${container.subtype.name}">Subtype Name</span></td>                        
                            </tr>                    
                        </tbody>
                    </table>
                    
                    <div class="row">
                        <div class="col-xs-10">
                            <div th:include="layout :: pagination_bar"></div>                       
                        </div>
                        
                        <div class="col-xs-2 pull-right">
                            <button type="submit" name="self" value="Allocate Container" class="btn btn-success btn-block btn-sm" th:value="#{container.allocate}">
                                <i class="glyphicon glyphicon-arrow-right"/>
                            </button>                        
                        </div>                        
                    </div>
                    
                    <br/> 

                    <b class="text-danger"><i class="glyphicon glyphicon-warning-sign"/><span th:text="#{container.no.matched}"></span></b>           
                </form>
            </div>
        </div><!-- panel -->
        
        <div class="panel panel-default">
            <div class="panel-body">
                <form method="post" th:action="'/task/' + ${taskId} + '/allocation'" th:object="${selfContainerAllocation}">
                    <input type="hidden" th:field="*{routeId}"/>
                    <input type="hidden" th:field="*{containerIds}" />                    
                    <div class="form-group">
                        <label th:text="#{container.no}">BIC Code</label>
                        <input type="text" id="bicCode" class="typeahead form-control input-sm" th:placeholder="#{container.no}"/>          
                    </div>
                    <input type="submit" name="self" value="Allocate Container" class="btn btn-success btn-sm" th:value="#{container.allocate}"/>
                </form>
            </div><!-- panel-body -->
        </div><!-- panel -->   
    </div><!-- container in stock -->

    <div class="col-lg-6">
        <div class="panel panel-default" th:each="route : ${containerAllocation.routes}">   
            <div class="panel-heading">
                <span th:text="#{route} + ${route.id}">Route</span>
                <span th:text="#{container.quantity} + '(' + ${route.containerQty} + ')'">Container Qty</span>
                
                <div class="pull-right">
                    <button class="btn btn-success btn-xs" data-toggle="modal" data-target="#myModal">
                        <i class="glyphicon glyphicon-plus" />
                    </button>
                    
                    <!-- Modal -->
                    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                                    <h4 class="modal-title" id="myModalLabel">Modal title</h4>
                                </div>
                                <div class="modal-body">
                                    <div th:include="container/template :: form" />
                                </div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                    <button type="button" class="btn btn-primary">Save changes</button>
                                </div>
                            </div>
                        </div>
                    </div>                    
                </div>
            </div>
                           
            <div class="panel-body">
                    <table class="table table-striped table-hover table-condensed table-16">
                        <thead>
                            <tr>
                                <th>BIC Code</th>
                                <th th:text="#{container.owner}">Owner</th>
                                <th th:text="#{container.yard}">Yard</th>
                                <th th:text="#{container.subtype}">Subtype</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr th:each="routeContainerAllocation : ${containerAllocation.routeContainerAllocations.?[routeId == __${route.id}__]}">
                            <form method="post" th:action="'/task/' + ${taskId} + '/allocation'">
                                <td><b><span th:text="${routeContainerAllocation.bicCode}">BIC Code</span></b></td>
                                <td><span th:text="${routeContainerAllocation.owner}">Owner Name</span></td>
                                <td><span th:text="${routeContainerAllocation.yard}">Yard Name</span></td>
                                <td><span th:text="${routeContainerAllocation.subtypeName}">Subtype Name</span></td>
                                <td>  
                                    <input type="hidden" name="allocationId" th:value="${routeContainerAllocation.allocationId}" />
                                    <button type="submit" class="close" name="undo"><span>&times;</span></button>
                                </td> 
                            </form>                     
                            </tr>                    
                        </tbody>
                    </table>               
            </div>
        </div><!-- panel -->     
    </div>
</div>

<!-- {!begin layout} -->
<div th:include="layout :: footer"></div>
<!-- {!end layout} -->

<!-- {!begin layout} -->
<div th:include="layout :: js"></div>
<!-- {!end layout} -->
</body>

<script>
    $(document).ready(function() {
        $('#bicCode').typeahead({
            name: 'container',
            valueKey: 'bicCode',
            limit: 10,
            remote: '/api/container?bicCode=%QUERY',
            template: '<p><strong>{{bicCode}}</strong></p>',
            engine: Hogan
          })
          .on('typeahead:selected', function (obj, datum) {
            console.log("obj");
            console.log(obj);
            console.log('datum');
            console.log(datum);
            console.log(datum.bicCode);
            console.log(datum.id);
            $('#containerIds').val(datum.id);
            console.log("container id " + $('#containerIds').val());    
        });       
    }); // ready end

</script>        

</html>
